var bone,_ref;bone={},bone.modules={},null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=bone:window.bone=bone,bone.$=window.$,bone.$(function(){return bone.history=new bone.History}),null!=(null!=(_ref=window.console)?_ref.log:void 0)&&(bone.log=function(){return console.log.apply(console,arguments)}),bone.config={},bone.set=function(a,b){return"templates"===a&&(bone.templates=b),bone.config[a]=b},bone.get=function(a){return bone.config[a]},bone.async={},bone.async.eachSeries=function(a,b,c){var d,e;return c=c||function(){},a.length?(d=0,e=function(){return b(a[d],function(b){return b?(c(b),c=function(){}):(d+=1,d>=a.length?c(null):e())})},e()):c()};var adapters,contextStore,messageId;messageId=0,contextStore={},bone.io=function(a,b){var c,d;return c=null!=(d=b.config)?d.adapter:void 0,null==c&&(c="socket.io"),bone.io.adapters[c](a,b)},bone.io.defaults={},bone.io.set=function(a,b){return bone.io.defaults[a]=b},adapters=bone.io.adapters={},adapters["socket.io"]=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;for(c={},null==b.config&&(b.config=bone.get("io.options")),c.error=b.error,c.source=a,c.options=b,c.socket=b.config.socket,c.inbound=b.inbound,null==c.inbound&&(c.inbound={}),c.outbound=b.outbound,null==c.outbound&&(c.outbound={}),null==(f=c.inbound).middleware&&(f.middleware=[]),null==(g=c.outbound).middleware&&(g.middleware=[]),null==(h=c.outbound).shortcuts&&(h.shortcuts=[]),null==(i=c.inbound).shortcuts&&(i.shortcuts=[]),n=c.outbound.shortcuts,j=function(b){return c[b]=function(d,e){return null==d&&(d={}),null!=bone.log&&bone.log("Outbound: ["+a+":"+b+"]",d),d._messageId=messageId+=1,contextStore[d._messageId]=e,c.socket.emit(""+a+":"+b,d)}},l=0,m=n.length;m>l;l++)e=n[l],j(e);o=c.inbound,k=function(b,d){return c.socket.on(""+a+":"+b,function(e){var f;return null!=bone.log&&bone.log("Inbound: ["+a+":"+b+"]",e),f=contextStore[e._messageId],delete contextStore[e._messageId],null==f&&(f={}),f.route=b,f.data=e,bone.async.eachSeries(c.inbound.middleware,function(a,b){return a(e,f,b)},function(a){return null!=a&&null!=c.error?c.error(a):d.apply(c,[e,f])})})};for(d in o)e=o[d],"middleware"!==d&&k(d,e);return c};var extend,isExplorer,rootStripper,routeStripper,trailingSlash;extend=function(a,b){var c;for(c in b)a[c]=b[c];return a},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,isExplorer=/msie [\w.]+/,trailingSlash=/\/$/,bone.History=function(){function a(){"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)}return a.prototype.interval=50,a.prototype.getHash=function(a){var b;return b=(a||this).location.href.match(/#(.*)$/),b?b[1]:""},a.prototype.getFragment=function(a,b){var c;return null==a&&(this._hasPushState||!this._wantsHashChange||b?(a=this.location.pathname,c=this.root.replace(trailingSlash,""),a.indexOf(c)||(a=a.substr(c.length))):a=this.getHash()),a.replace(routeStripper,"")},a.prototype.start=function(a){var b,c,d,e,f,g=this;return this.options=extend({},{root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState),d=this.getFragment(),c=document.documentMode,f=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!c||7>=c),this.root=("/"+this.root+"/").replace(rootStripper,"/"),f&&this._wantsHashChange&&(this.iframe=bone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(d)),this._hasPushState?bone.$(window).on("popstate",function(){return g.checkUrl.apply(g,arguments)}):this._wantsHashChange&&"onhashchange"in window&&!f?bone.$(window).on("hashchange",function(){return g.checkUrl.apply(g,arguments)}):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=d,e=this.location,b=e.pathname.replace(/[^\/]$/,"$&/")===this.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&b&&e.hash&&(this.fragment=this.getHash().replace(routeStripper,""),this.history.replaceState({},document.title,this.root+this.fragment+e.search)),this.options.silent?void 0:this.loadUrl())},a.prototype.route=function(a,b){return this.handlers.unshift({route:a,callback:b})},a.prototype.checkUrl=function(){var a;return a=this.getFragment(),a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),this.loadUrl()||this.loadUrl(this.getHash()))},a.prototype.handlers=[],a.prototype.loadUrl=function(a){var b,c,d,e,f,g,h,i;for(c=this.fragment=this.getFragment(a),h=this.handlers,i=[],f=0,g=h.length;g>f;f++)d=h[f],d.route.test(c)?(b=d.route.exec(c).slice(1),null!=bone.log&&bone.log("Route: ["+d.route+":"+c+"]",b),null==(e=d.router).middleware&&(e.middleware=[]),bone.async.eachSeries(d.router.middleware,function(a,b){return a.apply(d.router,[c,b])},function(){return d.callback.apply(d.router,b)})):i.push(void 0);return i},a.prototype.navigate=function(a,b){var c;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){if(this.fragment=a,c=this.root+a,this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},a.prototype._updateHash=function(a,b,c){var d;return c?(d=a.href.replace(/(javascript:|#).*$/,""),a.replace(d+"#"+b)):a.hash="#"+b},a}();var id,initView;id=0,initView=function(a,b,c){var d,e,f,g,h;d=$(a),f={},f.id=id+=1,d.attr("data-bone-id",id),f.data=function(){return d.data.apply(d,arguments)},f.$=function(){return d.find.apply(d,arguments)},f.el=a,f.$el=d,h=function(a,b){return f[a]=function(){var d;return null!=bone.log&&(d="View: ["+c.selector+":"+a+"]",bone.log(d,f.el,arguments)),b.apply(f,arguments)}};for(g in c)e=c[g],"events"!==g&&("[object Function]"===Object.prototype.toString.call(e)?h(g,e):f[g]=e);return null!=c.initialize&&c.initialize.apply(f,[]),f},bone.view=function(a,b){var c,d,e,f,g,h,i,j;h=function(c){var d,e,f,g,h,i,j,k;if("string"==typeof c)return g=""+a+c,bone.view(g,b);for(e=c,k=$(a),i=0,j=k.length;j>i;i++)if(h=k[i],d=$(h),f=d.data("boneView"),null==f&&(f=initView(h,this,b),d.data("boneView",f)),e===f.id)return f},b.selector=a,e=b.events,i=function(c,d){var e,f,g,i,j,k;return g=/^(\S+)\s*(.*)$/,j=c.match(g),f=j[1],k=j[2],i=a,null!=k&&(i+=" "+k),e=b[d],$(function(){return $("body").on(f,i,function(c){var d,g,j;return j=$(c.currentTarget).parents(a)[0],null==j&&(j=c.currentTarget),null!=bone.log&&(g="Interface: ["+i+":"+f+"]",bone.log(g,j)),d=$(j).data("bone-view"),null==d&&(d=initView(j,h,b),$(j).data("bone-view",d)),$.trim(a)!==$.trim(i)&&(j=$(i).parents(a)[0]),e.call(d,c)})})};for(d in e)f=e[d],"events"!==f&&i(d,f);j=function(c,d){return h[c]=function(){var e,f,g,i,j,k;for(e=arguments,j=$(a),k=[],g=0,i=j.length;i>g;g++)f=j[g],k.push(function(f){var g,i;return g=$(f).data("bone-view"),null==g&&(g=initView(f,h,b),$(f).data("bone-view")),null!=bone.log&&(i="View: ["+a+":"+c+"]",bone.log(i,f,e)),d.apply(g,e)}(f));return k}};for(g in b)c=b[g],"events"!==g&&("[object Function]"===Object.prototype.toString.call(c)?j(g,c):h[g]=c);return h};var routeToRegex;routeToRegex=function(a){var b,c,d,e;return d=/\((.*?)\)/g,c=/(\(\?)?:\w+/g,e=/\*\w+/g,b=/[\-{}\[\]+?.,\\\^$|#\s]/g,a=a.replace(b,"\\$&").replace(d,"(?:$1)?").replace(c,function(a,b){return b?a:"([^/]+)"}).replace(e,"(.*?)"),new RegExp("^"+a+"$")},bone.router=function(a){return $(function(){var b,c,d;d=a.routes;for(c in d)b=d[c],"routes"!==c&&(c=routeToRegex(c),bone.history.handlers.push({route:c,callback:a[b],router:a}));return null!=a.initialize?a.initialize():void 0})};var $;$=bone.$,bone.mount=function(a,b,c){var d,e,f,g,h,i,j,k;if(null==c&&(c={}),e=c.data,g=c.refresh,null==g&&(g=!1),d=$(a),j=bone.templates[b],k=null!=e?j(e):j(),0!==d.children().length){if(f=d.data("bone-mount"),i=f.template===b,h=f.data===e,i&&h&&!g)return;d.children().remove()}return d.html(k),d.data("bone-mount",{template:b,data:e})};