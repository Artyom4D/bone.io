(function(){var t,e,n,o,r,i,a,s,h,u;window.bone={},bone.$=window.$,e=function(t,e){var n;for(n in e)t[n]=e[n];return t},i=/^[#\/]|\s+$/g,r=/^\/+|\/+$/g,o=/msie [\w.]+/,u=/\/$/,bone.History=function(){function t(){"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)}return t.prototype.interval=50,t.prototype.getHash=function(t){var e;return e=(t||this).location.href.match(/#(.*)$/),e?e[1]:""},t.prototype.getFragment=function(t,e){var n;return null==t&&(this._hasPushState||!this._wantsHashChange||e?(t=this.location.pathname,n=this.root.replace(u,""),t.indexOf(n)||(t=t.substr(n.length))):t=this.getHash()),t.replace(i,"")},t.prototype.start=function(t){var n,a,s,h,u,c=this;return this.options=e({},{root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState),s=this.getFragment(),a=document.documentMode,u=o.exec(navigator.userAgent.toLowerCase())&&(!a||7>=a),this.root=("/"+this.root+"/").replace(r,"/"),u&&this._wantsHashChange&&(this.iframe=bone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(s)),this._hasPushState?bone.$(window).on("popstate",function(){return c.checkUrl.apply(c,arguments)}):this._wantsHashChange&&"onhashchange"in window&&!u?bone.$(window).on("hashchange",function(){return c.checkUrl.apply(c,arguments)}):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=s,h=this.location,n=h.pathname.replace(/[^\/]$/,"$&/")===this.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!n?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&n&&h.hash&&(this.fragment=this.getHash().replace(i,""),this.history.replaceState({},document.title,this.root+this.fragment+h.search)),this.options.silent?void 0:this.loadUrl())},t.prototype.route=function(t,e){return this.handlers.unshift({route:t,callback:e})},t.prototype.checkUrl=function(){var t;return t=this.getFragment(),t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()))},t.prototype.handlers=[],t.prototype.loadUrl=function(t){var e,n,o,r,i,a,s;for(n=this.fragment=this.getFragment(t),a=this.handlers,s=[],r=0,i=a.length;i>r;r++)o=a[r],o.route.test(n)?(e=o.route.exec(n).slice(1),bone.log&&console.log("Route: ["+o.route+":"+n+"]",e),o.callback.apply(o.router,e)):s.push(void 0);return s},t.prototype.navigate=function(t,e){var n;if(e&&e!==!0||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){if(this.fragment=t,n=this.root+t,this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},t.prototype._updateHash=function(t,e,n){var o;return n?(o=t.href.replace(/(javascript:|#).*$/,""),t.replace(o+"#"+e)):t.hash="#"+e},t}(),bone.$(function(){return bone.history=new bone.History}),bone.log=!0,t=/^(\S+)\s*(.*)$/,s=Array.prototype.slice,h=Object.prototype.toString,n=function(t,e,n){var o,r,i,a,s;o=$(t),i={},i.data=function(){return o.data.apply(o,arguments)},i.$=function(){return o.find.apply(o,arguments)},i.el=t,i.$el=$(t),s=function(t,e){return i[t]=function(o){var r;return bone.log&&(r="View: ["+n.selector+":"+t+"]",console.log(r,i.el,o)),e.call(i,o)}};for(a in n)r=n[a],"events"!==a&&("[object Function]"===h.call(r)?s(a,r):i[a]=r);return i},bone.view=function(e,o){var r,i,a,s,u,c,l,g;c={},a=o.events,l=function(r,i){var a,s,h,u,l;return u=r.match(t),s=u[1],l=u[2],h=e,null!=l&&(h+=" "+l),a=o[i],$(function(){return $("body").on(s,h,function(t){var r,i,u;return u=$(t.currentTarget).parents(e)[0],bone.log&&(i="Interface: ["+h+":"+s+"]",console.log(i,u)),r=$(u).data("bone-view"),null==r&&(r=n(u,c,o),$(u).data("bone-view",r)),$.trim(e)!==$.trim(h)&&(u=$(h).parents(e)[0]),a.call(r,u,t)})})};for(i in a)s=a[i],"events"!==s&&l(i,s);g=function(t,r){return c[t]=function(i){var a,s,h,u,l;for(u=$(e),l=[],s=0,h=u.length;h>s;s++)a=u[s],l.push(function(a){var s,h;return s=$(a).data("bone-view"),null==s&&(s=n(a,c,o),$(a).data("bone-view")),bone.log&&(h="View: ["+e+":"+t+"]",console.log(h,a,i)),r.call(s,i)}(a));return l}};for(u in o)r=o[u],"events"!==u&&("[object Function]"===h.call(r)?g(u,r):c[u]=r);return c},bone.io={},bone.io.sources={},bone.io.get=function(t){var e;return e=bone.io.sources[t],null!=e?e:(e=io.connect(),bone.io.sources[t]=e,e)},bone.io.route=function(t,e){var n,o,r,i;r=bone.io.get(t),i=[];for(o in e)n=e[o],i.push(function(e,n){return r.socket.on(""+t+":"+e,function(o){var r;return bone.log&&(r="Data-In: ["+t+":"+e+"]",console.log(r,o)),n(o)})}(o,n));return i},bone.io.configure=function(t,e){var n,o,r,i,a,s;for(o=t,t=bone.io.sources[t]={socket:io.connect()},a=e.actions,s=[],r=0,i=a.length;i>r;r++)n=a[r],s.push(function(e){return t[e]=function(n){return bone.log&&console.log("Data-Out: ["+o+":"+e+"]",n),t.socket.emit(""+o+":"+e,n)}}(n));return s},a=function(t){var e,n,o,r;return o=/\((.*?)\)/g,n=/(\(\?)?:\w+/g,r=/\*\w+/g,e=/[\-{}\[\]+?.,\\\^$|#\s]/g,t=t.replace(e,"\\$&").replace(o,"(?:$1)?").replace(n,function(t,e){return e?t:"([^/]+)"}).replace(r,"(.*?)"),RegExp("^"+t+"$")},bone.router=function(t){return $(function(){var e,n,o;o=t.routes;for(n in o)e=o[n],"routes"!==n&&(n=a(n),bone.history.handlers.push({route:n,callback:t[e],router:t}));return t.initialize()})}}).call(this);