var bone,_ref;bone={},null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=bone:window.bone=bone,bone.$=window.$,bone.$(function(){return bone.history=new bone.History}),null!=(null!=(_ref=window.console)?_ref.log:void 0)&&(bone.log=function(){return console.log.apply(console,arguments)});var only_once,_each;bone.async={},_each=function(t,e){var n,r;if(t.forEach)return t.forEach(e);for(n=0,r=[];t.length>n;)e(t[n],n,t),r.push(n+=1);return r},only_once=function(t){var e;return e=!1,function(){if(e)throw Error("Callback was already called.");return e=!0,t.apply(root,arguments_)}},bone.async.each=function(t,e,n){var r;return n=n||function(){},t.length?(r=0,_each(t,function(o){return e(o,only_once(function(e){return e?(n(e),n=function(){}):(r+=1,r>=t.length?n(null):void 0)}))})):n()};var extend,isExplorer,rootStripper,routeStripper,trailingSlash;extend=function(t,e){var n;for(n in e)t[n]=e[n];return t},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,isExplorer=/msie [\w.]+/,trailingSlash=/\/$/,bone.History=function(){function t(){"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)}return t.prototype.interval=50,t.prototype.getHash=function(t){var e;return e=(t||this).location.href.match(/#(.*)$/),e?e[1]:""},t.prototype.getFragment=function(t,e){var n;return null==t&&(this._hasPushState||!this._wantsHashChange||e?(t=this.location.pathname,n=this.root.replace(trailingSlash,""),t.indexOf(n)||(t=t.substr(n.length))):t=this.getHash()),t.replace(routeStripper,"")},t.prototype.start=function(t){var e,n,r,o,i,a=this;return this.options=extend({},{root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState),r=this.getFragment(),n=document.documentMode,i=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n),this.root=("/"+this.root+"/").replace(rootStripper,"/"),i&&this._wantsHashChange&&(this.iframe=bone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(r)),this._hasPushState?bone.$(window).on("popstate",function(){return a.checkUrl.apply(a,arguments)}):this._wantsHashChange&&"onhashchange"in window&&!i?bone.$(window).on("hashchange",function(){return a.checkUrl.apply(a,arguments)}):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r,o=this.location,e=o.pathname.replace(/[^\/]$/,"$&/")===this.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!e?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&e&&o.hash&&(this.fragment=this.getHash().replace(routeStripper,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search)),this.options.silent?void 0:this.loadUrl())},t.prototype.route=function(t,e){return this.handlers.unshift({route:t,callback:e})},t.prototype.checkUrl=function(){var t;return t=this.getFragment(),t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()))},t.prototype.handlers=[],t.prototype.loadUrl=function(t){var e,n,r,o,i,a,s;for(n=this.fragment=this.getFragment(t),a=this.handlers,s=[],o=0,i=a.length;i>o;o++)r=a[o],r.route.test(n)?(e=r.route.exec(n).slice(1),bone.log&&console.log("Route: ["+r.route+":"+n+"]",e),r.callback.apply(r.router,e)):s.push(void 0);return s},t.prototype.navigate=function(t,e){var n;if(e&&e!==!0||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){if(this.fragment=t,n=this.root+t,this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},t.prototype._updateHash=function(t,e,n){var r;return n?(r=t.href.replace(/(javascript:|#).*$/,""),t.replace(r+"#"+e)):t.hash="#"+e},t}();var initView;initView=function(t,e,n){var r,o,i,a,s;r=$(t),i={},i.data=function(){return r.data.apply(r,arguments)},i.$=function(){return r.find.apply(r,arguments)},i.el=t,i.$el=$(t),s=function(t,e){return i[t]=function(r){var o;return null!=bone.log&&(o="View: ["+n.selector+":"+t+"]",bone.log(o,i.el,r)),e.call(i,r)}};for(a in n)o=n[a],"events"!==a&&("[object Function]"===Object.prototype.toString.call(o)?s(a,o):i[a]=o);return i},bone.view=function(t,e){var n,r,o,i,a,s,h,u;s={},o=e.events,h=function(n,r){var o,i,a,h,u,l;return a=/^(\S+)\s*(.*)$/,u=n.match(a),i=u[1],l=u[2],h=t,null!=l&&(h+=" "+l),o=e[r],$(function(){return $("body").on(i,h,function(n){var r,a,u;return u=$(n.currentTarget).parents(t)[0],null!=bone.log&&(a="Interface: ["+h+":"+i+"]",bone.log(a,u)),r=$(u).data("bone-view"),null==r&&(r=initView(u,s,e),$(u).data("bone-view",r)),$.trim(t)!==$.trim(h)&&(u=$(h).parents(t)[0]),o.call(r,u,n)})})};for(r in o)i=o[r],"events"!==i&&h(r,i);u=function(n,r){return s[n]=function(o){var i,a,h,u,l;for(u=$(t),l=[],a=0,h=u.length;h>a;a++)i=u[a],l.push(function(i){var a,h;return a=$(i).data("bone-view"),null==a&&(a=initView(i,s,e),$(i).data("bone-view")),null!=bone.log&&(h="View: ["+t+":"+n+"]",bone.log(h,i,o)),r.call(a,o)}(i));return l}};for(a in e)n=e[a],"events"!==a&&("[object Function]"===Object.prototype.toString.call(n)?u(a,n):s[a]=n);return s};var adapters;bone.io=function(t,e){return adapters[e.adapter](t,e)},adapters=bone.io.adapters={},adapters["socket.io"]=function(t,e){var n,r,o,i,a,s,h,u,l,c,p,f,g;for(n={},n.error=e.error,n.source=t,n.options=e,n.socket=e.options.socket,n.inbound=e.inbound,n.outbound=e.outbound,null==(c=(i=n.inbound).middleware)&&(i.middleware=[]),null==(p=(a=n.outbound).middleware)&&(a.middleware=[]),f=n.outbound,s=function(e){return n[e]=function(r){return null!=bone.log&&bone.log("Outbound: ["+t+":"+e+"]",r),n.socket.emit(""+t+":"+e,r)}},u=0,l=f.length;l>u;u++)o=f[u],s(o);g=n.inbound,h=function(e,r){return n.socket.on(""+t+":"+e,function(o){var i;return null!=bone.log&&bone.log("Inbound: ["+t+":"+e+"]",o),i={},bone.async.each(n.inbound.middleware,function(t,e){return t(o,i,e)},function(t){return null!=t&&null!=n.error?n.error(t):r.apply(n,[o,i])})})};for(r in g)o=g[r],"middleware"!==r&&h(r,o);return n};var routeToRegex;routeToRegex=function(t){var e,n,r,o;return r=/\((.*?)\)/g,n=/(\(\?)?:\w+/g,o=/\*\w+/g,e=/[\-{}\[\]+?.,\\\^$|#\s]/g,t=t.replace(e,"\\$&").replace(r,"(?:$1)?").replace(n,function(t,e){return e?t:"([^/]+)"}).replace(o,"(.*?)"),RegExp("^"+t+"$")},bone.router=function(t){return $(function(){var e,n,r;r=t.routes;for(n in r)e=r[n],"routes"!==n&&(n=routeToRegex(n),bone.history.handlers.push({route:n,callback:t[e],router:t}));return t.initialize()})};var $;$=bone.$,bone.mount=function(t,e,n,r){var o,i,a;if(o=$(t),i=bone.templates[e],a=i(n),0!==o.children().length){if(r.refresh)return;o.children().remove()}return o.html(a)};